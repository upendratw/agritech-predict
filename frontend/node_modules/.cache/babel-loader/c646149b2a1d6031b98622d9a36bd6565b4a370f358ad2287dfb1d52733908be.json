{"ast":null,"code":"// frontend/src/api.js\nconst BASE = process.env.REACT_APP_BACKEND_URL || \"http://localhost:8600\";\n\n/**\n * Simple health check — ensures backend root returns 200.\n * Returns true/false.\n */\nexport async function checkBackend(timeoutMs = 2500) {\n  try {\n    const controller = new AbortController();\n    const id = setTimeout(() => controller.abort(), timeoutMs);\n    const res = await fetch(`${BASE}/`, {\n      method: \"GET\",\n      signal: controller.signal\n    });\n    clearTimeout(id);\n    return res.ok;\n  } catch (err) {\n    return false;\n  }\n}\n\n/**\n * Upload an image file to the backend /infer endpoint.\n *\n * - file: File object from input[type=file]\n * - opts: { image_size, score_threshold, topk }\n *\n * Returns a normalized result object:\n * {\n *   image_url: \"/static/results/out_....png\" OR fully-qualified,\n *   counts: {label: count, ...},\n *   raw_boxes_count: number,\n *   boxes_count: number,\n *   boxes: [{ label, score }, ...]  // may be empty if backend doesn't return boxes\n * }\n */\nexport async function inferImage(file, opts = {}) {\n  var _opts$image_size, _opts$score_threshold, _opts$topk, _payload$counts, _payload$raw_boxes_co, _ref, _payload$image_url;\n  const image_size = (_opts$image_size = opts.image_size) !== null && _opts$image_size !== void 0 ? _opts$image_size : 512;\n  const score_threshold = (_opts$score_threshold = opts.score_threshold) !== null && _opts$score_threshold !== void 0 ? _opts$score_threshold : 0.3;\n  const topk = (_opts$topk = opts.topk) !== null && _opts$topk !== void 0 ? _opts$topk : 200;\n  const query = new URLSearchParams({\n    image_size: String(image_size),\n    score_threshold: String(score_threshold),\n    topk: String(topk)\n  }).toString();\n  const url = `${BASE}/infer?${query}`;\n  const fd = new FormData();\n  // IMPORTANT: backend expects multipart field name \"image\"\n  fd.append(\"image\", file, file.name);\n  const res = await fetch(url, {\n    method: \"POST\",\n    body: fd\n  });\n  if (!res.ok) {\n    var _errBody;\n    // try to parse returned JSON error message\n    let errBody = null;\n    try {\n      errBody = await res.json();\n    } catch (e) {\n      // ignore\n    }\n    const msg = (_errBody = errBody) !== null && _errBody !== void 0 && _errBody.detail ? JSON.stringify(errBody.detail) : `${res.status} ${res.statusText}`;\n    throw new Error(`Infer failed: ${res.status} ${res.statusText} — ${msg}`);\n  }\n  const payload = await res.json();\n\n  // Normalize payload into a friendly shape the UI expects\n  const result = {\n    image_url: null,\n    counts: (_payload$counts = payload.counts) !== null && _payload$counts !== void 0 ? _payload$counts : {},\n    raw_boxes_count: (_payload$raw_boxes_co = payload.raw_boxes_count) !== null && _payload$raw_boxes_co !== void 0 ? _payload$raw_boxes_co : 0,\n    boxes_count: 0,\n    boxes: [],\n    raw: payload\n  };\n\n  // image_url may be returned as image_url or out_image_url (some variants)\n  const imgPath = (_ref = (_payload$image_url = payload.image_url) !== null && _payload$image_url !== void 0 ? _payload$image_url : payload.out_image_url) !== null && _ref !== void 0 ? _ref : null;\n  if (imgPath) {\n    // If backend returned absolute URL (http(s)...) use it; otherwise prefix BASE\n    if (imgPath.startsWith(\"http://\") || imgPath.startsWith(\"https://\")) {\n      result.image_url = imgPath;\n    } else {\n      // ensure no double-slash\n      result.image_url = `${BASE}${imgPath.startsWith(\"/\") ? \"\" : \"/\"}${imgPath}`;\n    }\n  }\n\n  // Some backends may also return detailed boxes/labels/scores; attempt to normalize\n  // Accept either: { boxes: [...], labels: [...], scores: [...] } or combined payload.boxes array\n  if (Array.isArray(payload.boxes) && payload.boxes.length > 0 && typeof payload.boxes[0] === \"object\") {\n    // payload.boxes likely is [{label, score, ...}, ...]\n    result.boxes = payload.boxes.map(b => {\n      var _b$label, _ref2, _b$lbl, _ref3, _b$confidence;\n      return {\n        label: (_b$label = b.label) !== null && _b$label !== void 0 ? _b$label : (_ref2 = (_b$lbl = b.lbl) !== null && _b$lbl !== void 0 ? _b$lbl : b.class) !== null && _ref2 !== void 0 ? _ref2 : \"\",\n        score: typeof b.score === \"number\" ? b.score : (_ref3 = (_b$confidence = b.confidence) !== null && _b$confidence !== void 0 ? _b$confidence : b.conf) !== null && _ref3 !== void 0 ? _ref3 : 0,\n        raw: b\n      };\n    });\n    result.boxes_count = result.boxes.length;\n  } else if (Array.isArray(payload.labels) && Array.isArray(payload.scores)) {\n    // separate arrays\n    const labels = payload.labels;\n    const scores = payload.scores;\n    result.boxes = labels.map((lab, i) => {\n      var _scores$i;\n      return {\n        label: String(lab),\n        score: (_scores$i = scores[i]) !== null && _scores$i !== void 0 ? _scores$i : 0\n      };\n    });\n    result.boxes_count = result.boxes.length;\n  } else if (payload.counts && Object.keys(payload.counts).length > 0) {\n    // If only counts are provided, create boxes array from counts for display (no per-box scores)\n    const boxes = [];\n    for (const [lbl, cnt] of Object.entries(payload.counts)) {\n      for (let i = 0; i < cnt; ++i) boxes.push({\n        label: lbl,\n        score: 1.0\n      });\n    }\n    result.boxes = boxes;\n    result.boxes_count = boxes.length;\n  } else {\n    var _payload$raw_boxes_co2;\n    // fallback to raw_boxes_count\n    result.boxes_count = (_payload$raw_boxes_co2 = payload.raw_boxes_count) !== null && _payload$raw_boxes_co2 !== void 0 ? _payload$raw_boxes_co2 : 0;\n  }\n  return result;\n}","map":{"version":3,"names":["BASE","process","env","REACT_APP_BACKEND_URL","checkBackend","timeoutMs","controller","AbortController","id","setTimeout","abort","res","fetch","method","signal","clearTimeout","ok","err","inferImage","file","opts","_opts$image_size","_opts$score_threshold","_opts$topk","_payload$counts","_payload$raw_boxes_co","_ref","_payload$image_url","image_size","score_threshold","topk","query","URLSearchParams","String","toString","url","fd","FormData","append","name","body","_errBody","errBody","json","e","msg","detail","JSON","stringify","status","statusText","Error","payload","result","image_url","counts","raw_boxes_count","boxes_count","boxes","raw","imgPath","out_image_url","startsWith","Array","isArray","length","map","b","_b$label","_ref2","_b$lbl","_ref3","_b$confidence","label","lbl","class","score","confidence","conf","labels","scores","lab","i","_scores$i","Object","keys","cnt","entries","push","_payload$raw_boxes_co2"],"sources":["/Users/upendra/Desktop/agritech-predict/frontend/src/api.js"],"sourcesContent":["// frontend/src/api.js\nconst BASE = process.env.REACT_APP_BACKEND_URL || \"http://localhost:8600\";\n\n/**\n * Simple health check — ensures backend root returns 200.\n * Returns true/false.\n */\nexport async function checkBackend(timeoutMs = 2500) {\n  try {\n    const controller = new AbortController();\n    const id = setTimeout(() => controller.abort(), timeoutMs);\n\n    const res = await fetch(`${BASE}/`, { method: \"GET\", signal: controller.signal });\n    clearTimeout(id);\n    return res.ok;\n  } catch (err) {\n    return false;\n  }\n}\n\n/**\n * Upload an image file to the backend /infer endpoint.\n *\n * - file: File object from input[type=file]\n * - opts: { image_size, score_threshold, topk }\n *\n * Returns a normalized result object:\n * {\n *   image_url: \"/static/results/out_....png\" OR fully-qualified,\n *   counts: {label: count, ...},\n *   raw_boxes_count: number,\n *   boxes_count: number,\n *   boxes: [{ label, score }, ...]  // may be empty if backend doesn't return boxes\n * }\n */\nexport async function inferImage(file, opts = {}) {\n  const image_size = opts.image_size ?? 512;\n  const score_threshold = opts.score_threshold ?? 0.3;\n  const topk = opts.topk ?? 200;\n\n  const query = new URLSearchParams({\n    image_size: String(image_size),\n    score_threshold: String(score_threshold),\n    topk: String(topk),\n  }).toString();\n\n  const url = `${BASE}/infer?${query}`;\n\n  const fd = new FormData();\n  // IMPORTANT: backend expects multipart field name \"image\"\n  fd.append(\"image\", file, file.name);\n\n  const res = await fetch(url, {\n    method: \"POST\",\n    body: fd,\n  });\n\n  if (!res.ok) {\n    // try to parse returned JSON error message\n    let errBody = null;\n    try {\n      errBody = await res.json();\n    } catch (e) {\n      // ignore\n    }\n    const msg = errBody?.detail ? JSON.stringify(errBody.detail) : `${res.status} ${res.statusText}`;\n    throw new Error(`Infer failed: ${res.status} ${res.statusText} — ${msg}`);\n  }\n\n  const payload = await res.json();\n\n  // Normalize payload into a friendly shape the UI expects\n  const result = {\n    image_url: null,\n    counts: payload.counts ?? {},\n    raw_boxes_count: payload.raw_boxes_count ?? 0,\n    boxes_count: 0,\n    boxes: [],\n    raw: payload,\n  };\n\n  // image_url may be returned as image_url or out_image_url (some variants)\n  const imgPath = payload.image_url ?? payload.out_image_url ?? null;\n  if (imgPath) {\n    // If backend returned absolute URL (http(s)...) use it; otherwise prefix BASE\n    if (imgPath.startsWith(\"http://\") || imgPath.startsWith(\"https://\")) {\n      result.image_url = imgPath;\n    } else {\n      // ensure no double-slash\n      result.image_url = `${BASE}${imgPath.startsWith(\"/\") ? \"\" : \"/\"}${imgPath}`;\n    }\n  }\n\n  // Some backends may also return detailed boxes/labels/scores; attempt to normalize\n  // Accept either: { boxes: [...], labels: [...], scores: [...] } or combined payload.boxes array\n  if (Array.isArray(payload.boxes) && payload.boxes.length > 0 && typeof payload.boxes[0] === \"object\") {\n    // payload.boxes likely is [{label, score, ...}, ...]\n    result.boxes = payload.boxes.map((b) => ({\n      label: b.label ?? (b.lbl ?? b.class ?? \"\"),\n      score: typeof b.score === \"number\" ? b.score : (b.confidence ?? b.conf ?? 0),\n      raw: b,\n    }));\n    result.boxes_count = result.boxes.length;\n  } else if (Array.isArray(payload.labels) && Array.isArray(payload.scores)) {\n    // separate arrays\n    const labels = payload.labels;\n    const scores = payload.scores;\n    result.boxes = labels.map((lab, i) => ({ label: String(lab), score: scores[i] ?? 0 }));\n    result.boxes_count = result.boxes.length;\n  } else if (payload.counts && Object.keys(payload.counts).length > 0) {\n    // If only counts are provided, create boxes array from counts for display (no per-box scores)\n    const boxes = [];\n    for (const [lbl, cnt] of Object.entries(payload.counts)) {\n      for (let i = 0; i < cnt; ++i) boxes.push({ label: lbl, score: 1.0 });\n    }\n    result.boxes = boxes;\n    result.boxes_count = boxes.length;\n  } else {\n    // fallback to raw_boxes_count\n    result.boxes_count = payload.raw_boxes_count ?? 0;\n  }\n\n  return result;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}